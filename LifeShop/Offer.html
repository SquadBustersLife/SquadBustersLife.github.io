// Fetch product data
async function loadProductData() {
    try {
        if (!productId) {
            showError('ID товара не указан');
            return;
        }
        
        // Load product data
        const response = await fetch(`https://raw.githubusercontent.com/SquadBustersLife/SquadBustersLife.github.io/main/LifeShop/Offer${productId}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        productData = await response.json();
        
        // Set product info
        document.getElementById('product-name').textContent = productData.Name;
        document.getElementById('product-description').textContent = productData.Description;
        
        // Check for discount
        if (productData.Discount) {
            discount = parseInt(productData.Discount);
        }
        
        // Handle buttons if they exist
        if (productData.Buttons && productData.Buttons.length > 0) {
            document.getElementById('button-selection').style.display = 'block';
            createButtonOptions(productData.Buttons);
            updatePrice(0); // Select first button by default
        } else {
            // No buttons, use base price
            updateBasePrice();
        }
        
        // Calculate and display rating
        if (productData.Reviews && productData.Reviews.length > 0) {
            // Convert string ratings to numbers before calculating
            const totalRating = productData.Reviews.reduce((sum, review) => sum + parseInt(review.R), 0);
            const averageRating = (totalRating / productData.Reviews.length).toFixed(1);
            
            const ratingStars = document.querySelector('.rating-stars');
            ratingStars.innerHTML = '';
            
            // Add filled stars
            for (let i = 0; i < Math.floor(averageRating); i++) {
                ratingStars.innerHTML += '<i class="fas fa-star"></i>';
            }
            
            // Add half star if needed
            if (averageRating % 1 >= 0.5) {
                ratingStars.innerHTML += '<i class="fas fa-star-half-alt"></i>';
            }
            
            // Add empty stars
            const emptyStars = 5 - Math.ceil(averageRating);
            for (let i = 0; i < emptyStars; i++) {
                ratingStars.innerHTML += '<i class="far fa-star"></i>';
            }
            
            document.querySelector('.rating-value').textContent = averageRating;
            
            // Display reviews
            displayReviews(productData.Reviews);
        } else {
            document.querySelector('.rating-stars').innerHTML = '<i class="far fa-star"></i>'.repeat(5);
            document.querySelector('.rating-value').textContent = '0.0';
            document.getElementById('reviews-container').innerHTML = `
                <div class="no-reviews">
                    <i class="fas fa-comment-slash"></i>
                    <p>Отзывов пока нет</p>
                </div>
            `;
        }
        
        // Load banners
        const banner1 = document.getElementById('banner1');
        const banner2 = document.getElementById('banner2');
        
        banner1.src = `https://raw.githubusercontent.com/SquadBustersLife/SquadBustersLife.github.io/main/LifeShop/Offer${productId}Banner1.png`;
        banner2.src = `https://raw.githubusercontent.com/SquadBustersLife/SquadBustersLife.github.io/main/LifeShop/Offer${productId}Banner2.png`;
        
        banner1.onload = function() {
            banner1.classList.remove('skeleton');
        };
        
        banner1.onerror = function() {
            banner1.src = 'https://via.placeholder.com/400x400/1a1a1a/8a2be2?text=Баннер+не+загружен';
            banner1.classList.remove('skeleton');
        };
        
        banner2.onload = function() {
            banner2.classList.remove('skeleton');
        };
        
        banner2.onerror = function() {
            banner2.src = 'https://via.placeholder.com/400x400/1a1a1a/8a2be2?text=Баннер+не+загружен';
            banner2.classList.remove('skeleton');
        };
        
        // Load related products
        await loadRelatedProducts();
        
    } catch (error) {
        console.error('Error loading product data:', error);
        showError('Не удалось загрузить информацию о товаре');
    }
}
